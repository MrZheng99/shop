<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
	<link rel="stylesheet" href="../css/main.css">
	<link rel="stylesheet" href="/back/css/common.css">
	<link rel="stylesheet" href="/back/css/style.css">
</head>
<body>
<div id="forms" class="mt10">
	<div class="box">
		<div class="box_border">
			<div class="box_center">
				<form id="myform">
				姓名：<input type="text" id="tname" class="input-text lh30" size="40"/>&nbsp;&nbsp;
				密码：<input type="password" id="pwd" class="input-text lh30" size="40"/>&nbsp;&nbsp;
				手机号码：<input type="tel" id="tel" class="input-text lh30" size="40"/>&nbsp;&nbsp;
				<input type="button" name="button" class="btn btn82 btn_save2" onclick="addAdmin()" value="添加"/>&nbsp;&nbsp;
				</form>
			</div>
		</div>
	</div>
</div>

<div id="table" class="mt10">
	<div class="box span10 oh">
		<table width="100%" border="0" cellpadding="0" cellspacing="0" class="list_table">
			<thead>
				<tr>
					<th width="20%">编号</th>
                   	<th width="20%">姓名</th>
                   	<th width="25%">联系方式</th>
                   	<th width="20%">状态</th>
                   	<th>操作</th>
                </tr>
            </thead>
            <tbody id="admin_info" align="center">


            </tbody>
		</table>
	</div>
</div>
</body>
<script type="text/javascript" src="../../js/md5.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>

<script>
	function addAdmin(){

		$.ajax({
			url:"/manager/addAdmin",
			type:"POST",
			data:{
				name:$("#tname").val().trim(),
				password:hex_md5($("#pwd").val().trim()),
				tel:$("#tel").val().trim()
			},
			success:function (o) {
				if(o.success){
					$("#tname").val("");
					$("#pwd").val("");
					$("#tel").val("");
					updateTable();

				}else {
					alert("添加失败");
				}
			}
		});
	}
	function updateAdmin(t,adminid) {
		console.log(t.textContent);
		let flag=1;
		if(t.textContent=="冻结"){
			flag = 0;
		}
		$.ajax({
			url:"/manager/updateAdmin",
			type:"POST",
			data:{
				status:flag,
				aid:adminid
			},
			success:function (o) {
				if(o.success){

					updateTable();
				}else {
					alert("更新失败");
				}
			}
		})
	}
	function updateTable(){
		$.ajax({
			url:"/manager/getAllAdminInfo",
			success:function (o) {
				let tr;
				let ele;
				$("#admin_info").empty();
				for(let i=0,len=o.data.length;i<len;i++){
					ele = o.data[i];
					tr = "<tr>" +
							"<td>"+ele["id"]+"</td>" +
							"<td>"+ele["name"]+"</td>" +
							"<td>"+ele["tel"]+"</td>" +
							"<td>"+(ele["status"]==1?"<font color='green'>正常</font>":"<font color='red'>正常</font>")+"</td>" +
							"<td><a href=\"javascript:void(0)\" onclick='updateAdmin(this,"+ele["id"]+")'>"+(ele["status"]==1?"<font color='red'>冻结</font>":"<font color='green'>解冻</font>")+"</a></td>" +
							"</tr>";
					console.log(tr);
					$("#admin_info").append(tr);
				}
			}
		});
	}
	window.onload=function () {
		updateTable();
	}
</script>
</html>
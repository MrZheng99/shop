<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>热卖</title>

<link rel="stylesheet" href="../css/common.css">
<link rel="stylesheet" href="../css/main.css">
</head>
<body>
<div class="mt10">
    <div class="box">
        <div class="box_border">
            <div class="box_center">
                <form id="myform">
                    商品类型：<select class="select" name="tno" id="goodsType">
                </select>&nbsp;&nbsp;
                    商品名称：<input type="tel" id="gname" class="input-text lh30" size="40" />&nbsp;&nbsp;
                    <input type="button" name="button" class="btn btn82 btn_search"
                           onclick="searchGoods()" value="查询" />&nbsp;&nbsp;
                </form>
            </div>
        </div>
    </div>
</div>
<div id="table" class="mt10">
    <div class="box span10 oh">
        <table width="100%" border="0" cellpadding="0" cellspacing="0"
               class="list_table">
            <thead>
            <tr>
                <th width="8%">编号</th>
                <th width="20%">名称</th>
                <th width="8%">状态</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody id="goods_info" align="center">

            </tbody>
        </table>
    </div>
</div>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript">
    var goodsType = {};
    $.get("../../types", function(result){
        let str = "";
        $.each(result, function(index, item){
            goodsType[item.gtid] = item.typename;
            str += `<option value="${item.gtid}">${item.typename}</option>`;
        });
        str = `<option value="">全部</option>`+str;
        $("#goodsType").append($(str));
        searchGoods();
    }, "json");

    function searchGoods(){
        const gtid = $("#goodsType").val();
        const gname = $("#gname").val();
        console.log(gtid, gname)
        $.get("/goods/hot", {tid:gtid, gname:gname}, function(data){
            console.log(data);
            let content = '';
            for(let item of data){
                content += /*html*/`<tr>
				<td>${item.gid}</td>
				<td>${item.goodsname}</td>
				<td class="green">已上架</td>
					<td><a href='javascript:changeStatus(${item.gid}, 0)' class='red'>[移除]</a></td>
				</tr>`;
            }
            $("#goods_info").html("").append($(content));
        })
    }

    function changeStatus(gid, status){
        $.post(`/good/${gid}`, {status:status}, function(result){
            if(result.success){
                searchGoods();
            }else{
                alert("失败");
            }
        })
    }
</script>
</body>
</html>
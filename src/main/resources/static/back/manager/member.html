<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>源辰-浏览管理员信息</title>
    <link rel="shortcut icon" href="/back/images/yc.png" type="image/x-icon"/>
    <link rel="stylesheet" href="/back/css/common.css">
    <link rel="stylesheet" href="/back/css/main.css">
    <script type="text/javascript" src="/back/js/jquery.min.js"></script>
</head>
<body>
<div class="mt10">
    <div class="box">
        <div class="box_border">
            <div class="box_center">
                <form id="myform">
                    账户名：<input type="text" id="mname" class="input-text lh30" size="40"/>&nbsp;&nbsp;
                    邮箱：<input type="email" id="meamil" class="input-text lh30" size="40"/>&nbsp;&nbsp;
                    <input type="button" name="button" class="btn btn82 btn_search" onclick="searchMember()"
                           value="查询"/>&nbsp;&nbsp;
                </form>
            </div>
        </div>
    </div>
</div>
<div id="table" class="mt10">
    <div class="box span10 oh">
        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="list_table">
            <thead>
            <tr>
                <th width="50">编号</th>
                <!--                   	<th width="100">昵称</th>-->
                <th width="100">账户名</th>
                <th width="100">真实名</th>
                <th width="50">性别</th>

                <th width="120">联系方式</th>
                <th width="200">注册邮箱</th>
                <!--                   	<th width="120">注册时间</th>-->
                <th width="8%">状态</th>
                <th width="120">操作</th>
            </tr>
            </thead>
            <tbody id="member_info" align="center">

            </tbody>
        </table>
    </div>
</div>
</body>
<script src="/js/md5.js"></script>
<script>
    function updateTable() {
        $.ajax({
            url: "/manager/getAllUserInfo",
            success: function (o) {
                let tr;
                let ele;

                $("#member_info").empty();

                for (let i = 0, len = o.data.length; i < len; i++) {
                    ele = o.data[i];
                    tr = "<tr>" +
                    "<td>" + ele["id"] + "</td>" +
                    "<td>" + ele["name"] + "</td>" +
                    "<td>" +  (ele["realName"]==null?"暂无":ele["realName"])+ "</td>" +
                    "<td>" + (ele["sex"]==null?"暂无":ele["sex"]) + "</td>" +
                    "<td>" + (ele["tel"]==null?"暂无":ele["tel"])+ "</td>" +
                        "<td>" + ele["email"] + "</td>" +
                        "<td><font color=\"green\">" + (ele["status"] == 1 ? "正常" : "冻结") + "</font></td>" +
                        "<td><a href=\"javascript:void(0)\" onclick='resetPwd(" + ele["id"] + ")'>[重置密码]</a><a href=\"javascript:void(0)\" onclick='updateUser(this," + ele["id"] + ")' class=\"red\">" + (ele["status"] == 1 ? "[冻结]" : "[解冻]") + "</a></td>" +
                        "</tr>";
                    $("#member_info").append(tr);
                }
            }
        });
    }

    /**
     * 查询用户
     *
     * */

    function searchMember() {
        let mname = $("#mname").val().trim();
        let memail = $("#meamil").val().trim();
        if (memail.length <= 0 || mname.length <= 0) {
            alert("名字和邮箱均不能为空");
            return;
        }
        $.ajax({
            url: "/manager/queryUser",
            type: "POST",
            data: {
                userName: mname,
                email: memail

            },
            success: function (o) {
                if (o.success) {
                    let tr;
                    let ele;
                    $("#member_info").empty();

                    for (let i = 0, len = o.data.length; i < len; i++) {
                        ele = o.data[i];
                        tr = "<tr>" +
                            "<td>" + ele["id"] + "</td>" +
                            "<td>" + ele["name"] + "</td>" +
                            "<td>" +  (ele["realName"]==null?"暂无":ele["realName"])+ "</td>" +
                            "<td>" + (ele["sex"]==null?"暂无":ele["sex"]) + "</td>" +
                            "<td>" + (ele["tel"]==null?"暂无":ele["tel"])+ "</td>" +
                            "<td>" + ele["email"] + "</td>" +
                            "<td><font color=\"green\">" + (ele["status"] == 1 ? "正常" : "冻结") + "</font></td>" +
                            "<td><a href=\"javascript:void(0)\" onclick='resetPwd(" + ele["id"] + ")'>[重置密码]</a><a href=\"javascript:void(0)\" onclick='updateUser(this," + ele["id"] + ")' class=\"red\">" + (ele["status"] == 1 ? "[冻结]" : "[解冻]") + "</a></td>" +

                            "</tr>";
                        console.log(tr);
                        $("#member_info").append(tr);
                    }


                } else {
                    alert("查找失败");
                }
            }
        });
    }

    /**
     * 重置用户密码
     * @param userId
     */
    function resetPwd(uid) {
        $.ajax({
            url: "/manager/updateUser",
            type: "POST",
            data: {
                userId: uid,
                type: "updatePassword",
                data: hex_md5("123456")
            },
            success: function (o) {
                if (o.success) {
                    updateTable();
                } else {
                    alert("更新失败");
                }
            }
        })
    }

    /**
     * 冻结或者解冻用户
     * @param t
     * @param userId
     */
    function updateUser(t, uid) {
        let flag = 1;
        if (t.textContent == "[冻结]") {
            flag = 0;
        }
        $.ajax({
            url: "/manager/updateUser",
            type: "POST",
            data: {
                data: flag,
                type: "updateStatus",
                userId: uid
            },
            success: function (o) {
                if (o.success) {
                    updateTable();
                } else {
                    alert("更新失败");
                }
            }
        });
    }

    window.onload = function () {
        updateTable();
    }
</script>
</html>
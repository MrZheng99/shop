<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>结账</title>
    <link rel="short icon" href="../images/logo.png" type="image/x-icon">

    <!-- CSS only -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/common.css">
    <style>
    	.pay-way ul{
    		list-style: none;
    		height: 100px;
    		width: 460px;
    		margin: 0 auto;
    		text-align:center;
    	} 
    	.pay-way li{
    		float: left;
    		padding: 15px;
    		height: 100px;
    		line-height: 100px;
    		vertical-align: center;
    	}
    	.pay-way li>img{
    		margin-left: 10px;
    	}
    </style>
</head>
<body class="container" style=" max-width: 600px">
    <div style="text-align: center">
        <h3>请扫码支付<span id="total-price"></span></h3>
    </div>
    <div>
    	<div class="pay-way">
    		<ul>
    			<li>
    				<input type="radio" onclick="switch_way(0);" name="pay-way" checked>
    				<img src="../images/wechat-pay-logo.png">
    			</li>
    			<li>
    				<input type="radio" onclick="switch_way(1);" name="pay-way">
    				<img src="../images/alipay-logo.png">
    			</li>
    		</ul>
    		<div style="height:300px;text-align:center;">
    			<img src="../images/pay-ercode.png" style="height:100%;" id="ercode">
    		</div>
    	</div>
    </div>
    <div style="clear:both;"></div>
    <div style="width: 100%;padding-left: 42%">
       <button class="btn btn-primary" onclick="pay()">支付完了</button>
    </div>
          <footer>

    Copyright&nbsp;&copy;&nbsp;2020&nbsp;&nbsp;ZYL团队&nbsp;版权所有

</footer>
    <!-- JS, Popper.js, and jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script>
    	const orderId = location.pathname.match(/\/pay\/(.*?)$/)[1];
    	function switch_way(option){
    		switch(option){
    		case 0:
    			console.log("微信");
				break;
    		case 1:
    			console.log("支付宝");
    			break;
    		}
    		// 假装更换了图片
    		$("#ercode").attr("src", "");
    		setTimeout(()=>{$("#ercode").attr("src", "/images/pay-ercode.png");}, 100);
    	}
    	function pay(){
    		$.post(`/pay/${orderId}`, function(data){
    			if(data && data.success){
					location.href = `/order/${orderId}`;
				} else {
					if(data && data.msg){
						alert(data.msg);
					}else{					
						alert("网络异常");
					}
				}
    		}, "json");
    	}
    	$.get(`/order/${orderId}/amount`, function(data){
    		if(data.success){
				$("#total-price").text(data.data)
			} else {
				location.href = "/index";
			}
    	}, "json")
    </script>
    
     <style>
    footer {
    height: 100px;
    width:100%;
    background-color: white;
    margin-top: 20px;
    text-align: center;
    font-size:16px;
}
    </style>
</body>
</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZYL商城主页</title>
    <link rel="stylesheet" type="text/css" href="../../css/home.css">
        <link rel="stylesheet" href="../../css/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    
</head>

<body>
    <div class="header">
    当前用户：<font id="userName"></font>
    <div class="header_right">
    <a href="/cart">购物车</a>
    </div>
    </div>
    <div class="search">
    <input id="inputSearch" placeholder="输入搜索" maxlength="30">
    <button id="search" value="搜索" class="btn btn-primary">搜索</button>
    </div>
    <div class="domes">
  <div id="dome">
    <div id="dome1">
    <table width="100%" border="0" cellspacing="0" cellpadding="0" >
  <tr align="center">
     <td><font color="#CC3300">~~~~~精品特卖，绝对超值~~~~~</font> </td>
  </tr>
  <tr align="center">
     <td><font color="#CC3300">~~~~~潮流新鞋，引领时尚~~~~~</font> </td>
  </tr>
  <tr align="center">
     <td><font color="#CC3300">~~~~~男女服装，质量保证~~~~~</font> </td>
  </tr>


</table>
      </div>
    <div id="dome2"></div>
  </div>
</div>
<div class="warp">
        <div class="broadcast" id="broadcast">
            <ul id="img_list">
                <li><img src="../../images/home_img1.jpg" alt="1"></li>
                <li><img src="../../images/home_img2.jpg" alt="2"></li>
                <li><img src="../../images/home_img3.jpg" alt="3"></li>
            </ul>
            <ol id="button_list"> <!-- 轮播按钮 -->
                <li class="first-li" id="olli1">1</li>
                <li id="olli2">2</li>
                <li id="olli3">3</li>
            </ol>
        </div>
    </div>
    <hr>
    <div class="categroy">

        <ol>
            <li>
                <div class="active">
                    <a class="categroyLink" href="#">精品特卖</a>
                </div>
            </li>

            <li>
                <div>
                    <a class="categroyLink" href="#"></a>
                </div>
            </li>

            <li>
                <div>
                    <a class="categroyLink" href="#"></a>
                </div>
            </li>

            <li>
                <div>
                    <a class="categroyLink" href="#"></a>
                </div>
            </li>

            <li>
                <div>
                    <a class="categroyLink" href="#"></a>
                </div>
            </li>

            <li>
                <div>
                    <a class="categroyLink" href="#"></a>
                </div>
            </li>
        </ol>
    </div>
    <div class="content">

    </div>
    <div class="pages">

    </div>
    <script src="../../js/jquery.js"></script>

    <script>
        $("#search").click(function() {
            $.ajax({
                type: 'POST',
                url: "/home/queryGoods" ,
                data:{goodsName:$("#inputSearch").val()},
                success: function(msg) {
                    if (msg.success) {
                        $(".content").empty();
                        for (let i = 0, len = msg.data.length; i < len; i++) {
                            let ele = msg.data[i];
   
                            let d = "<div class='disp'><img src='../" + ele["imgUrl"] + "'><span class='description'>" + ele["name"] + ele["description"] + "</span> <span class='price'>" + "￥" + ele["price"] + "</span><button>加入购物车</button></div>"
                            $(".content").append(d);
                        }
                    }
                }

            });

        });
        //分页
        function loadPageNumber(categroy) {
            $.ajax({
                type: 'GET',
                url: "/home/queryGoodsNumber/" + categroy,
                success: function(msg) {
                    if (msg.success) {
                        let pages = Math.ceil(msg.data / 8);
                        $(".pages").empty();

                        for (let i = 1; i <= pages; i++) {
                            $(".pages").append("<span class='pageNumber'>" + i + "</span>");
                            $(".pageNumber:eq(" + (i - 1) + ")").click(function() {
                                getGoods(categroy + "/" + (i - 1));
                                $(".pageNumber").removeClass("active");
                                $(".pageNumber:eq(" + (i - 1) + ")").addClass("active");
                            });
                        }
                    } else {
                        $(".categroy.ol li:last").after('加载失败');
                    }
                }

            });
        }

        function getGoods(categroy) {
            $.ajax({
                type: 'GET',
                url: "/home/queryGoods/" + categroy,
                success: function(msg) {
                    if (msg.success) {
                        $(".content").empty();
                        for (let i = 0, len = msg.data.length; i < len; i++) {
                            let ele = msg.data[i];
                            let d = "<div class='disp'><img src='../" + ele["imgUrl"] + "'><span class='description'>" + ele["name"] + ele["description"] + "</span> <span class='price'>" + "￥" + ele["price"] + "</span><button>加入购物车</button></div>"
                            $(".content").append(d);
                        }
                    }
                }

            });
        }
        window.onload = function() {
            getGoods("all");
            loadPageNumber("all");
            for (let i = 0; i < 6; i++) {
                $(".categroyLink:eq(" + (i) + ")").click(function() {
                    $(".categroyLink").parent("div").removeClass("active");
                    $(".categroyLink:eq(" + (i) + ")").parent("div").addClass("active");
                    if (i > 0) {
                        getGoods(this.text);
                        loadPageNumber(this.text);

                    } else {
                        getGoods("all");
                        loadPageNumber("all");

                    }

                });
            }
            //最后一个右边距0
            for (let i = 0; i < 8; i++) {
                if (i % 4 == 3) {
                    $(".disp:eq(" + (i) + ")").addClass("last");

                }
            }
        }
        $.ajax({

            type: 'GET',
            url: "/home/queryName",
            success: function(msg) {
                if (msg.success) {
                    $("#userName").text(msg.data);
                } else {
                    $("#userName").text('未登录');
                }
            }

        });
        $.ajax({
            type: 'GET',
            url: "/home/queryCategroy",
            success: function(msg) {
                if (msg.success) {
                    let categroies = msg.data;
                    for (let i = 0; i < 5; i++) {

                        $(".categroyLink:eq(" + (i + 1) + ")").text(categroies[i]);
                    }
                } else {
                    $(".categroy.ol li:last").after('加载失败');
                }
            }

        });
		
		
    </script>
    
    <script>
	// JavaScript Document
  function $(element){
	  return document.getElementById(element);
	  }
   
   var dome=$("dome");
   var dome1=$("dome1");
   var dome2=$("dome2");
   var speed=50;  //设置向上滚动速度
   dome2.innerHTML=dome1.innerHTML //复制dome1为dome2
   function moveTop(){
   if(dome2.offsetTop-dome.scrollTop<=0)   //当滚动至dome1与dome2交界时
   dome.scrollTop-=dome1.offsetHeight      //dome跳到最顶端
   else{
   dome.scrollTop++
   }
   }
   var MyMar=setInterval(moveTop,speed) //设置定时器
   dome.onmouseover=function() {clearInterval(MyMar)}//鼠标移上时清除定时器达到滚动停止的目的
   dome.onmouseout=function() {MyMar=setInterval(moveTop,speed)}//鼠标移开时重设定时器，继续滚动
	</script>
    <script>
window.onload = function () {
    var broadcast = document.getElementById("broadcast"),
        img_list = document.getElementById("img_list"),
        button_list = document.getElementById("button_list").getElementsByTagName("li"),
        index = 0,
        timer = null;
        //初始化
        if (timer) {
            clearInterval(timer);
            timer = null;
        }
   
        // 自动切换
        timer = setInterval(autoPlay, 3000);
   
        // 调用自动播放函数
        function autoPlay() {
            index++;
            if (index >= button_list.length) {
                index = 0;
            }
            imgChange(index);
        }
    
    function imgChange(buttonIndex) {
        for (let i = 0; i < button_list.length; i++) {
            button_list[i].className="";
        }
        button_list[buttonIndex].className = "first-li";//按钮样式切换
        img_list.style.marginLeft = -1000 * buttonIndex + "px";
        index = buttonIndex;
    }
    //鼠标接触div
    broadcast.onmouseover = function(){
        clearInterval(timer);

    }
    //鼠标离开div
    broadcast.onmouseout = function(){
        timer = setInterval(autoPlay, 2000);
    }
    //鼠标悬停ol
    for (var i = 0; i < button_list.length; i++) {
        button_list[i].id = i;
        button_list[i].onmouseover = function() {
            clearInterval(timer);
            imgChange(this.id);
        }
    }
}

</script>
</body>

</html>
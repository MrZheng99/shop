<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZYL商城主页</title>
    <link rel="stylesheet" type="text/css" href="../../css/home.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

</head>

<body>

<header>
    <font class="text-primary">当前用户:&nbsp;</font>
    <a class="text-primary" id="userName"></a>
    <div class="header_right">
        <input id="inputSearch" placeholder="输入搜索" maxlength="30" class="form-control"
               style="display: inline-block; width: 150px;">
        <a href="/orders" class="btn btn-link">订单</a>
        <a href="/cart" class="btn btn-link">购物车</a>
    </div>
</header>
<div class="container" style="min-width: 100%;">

    <div>

        <div class="dome">
            <ul id="demoLi">
                <li>~~~~~精品特卖，绝对超值~~~~~</li>
                <li >~~~~~潮流新鞋，引领时尚~~~~~</li>
                <li>~~~~~男女服装，质量保证~~~~~</li>
            </ul>

        </div>
    </div>

    <div class="warp">
        <div class="broadcast" id="broadcast">
            <ul id="img_list">
                <li><img src="../../images/home_img1.jpg" alt="1"></li>
                <li><img src="../../images/home_img2.jpg" alt="2"></li>
                <li><img src="../../images/home_img3.jpg" alt="3"></li>
            </ul>
            <ol id="button_list">
                <!-- 轮播按钮 -->
                <li class="first-li" id="olli1">1</li>
                <li id="olli2">2</li>
                <li id="olli3">3</li>
            </ol>
        </div>
    </div>
    <hr>
    <div class="categroy">
        <ol>
            <li>
                <div class="active">
                    <a class="categroyLink" href="#">精品特卖</a>
                </div>
            </li>
        </ol>
    </div>
    <div class="content">

    </div>
    <div id="pagination">

    </div>
</div>
<footer>
    <div >
        Copyright&nbsp;&copy;&nbsp;2020&nbsp;&nbsp;ZYL团队&nbsp;版权所有
    </div>
</footer>
<!--<script src="../../js/jquery.js"></script>-->
<!-- JS, Popper.js, and jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<
<script src="../../js/showPages.js"></script>
<script>
    $("#inputSearch").keyup(function (e) {
        if(e.keyCode==13){
            window.location.href = "../search?goodsName="+$(this).val().trim(); }
    });

    //跳转到浏览商品详情界面
    function goShopping(goodsId) {
        window.location.href = "../shopping/" + goodsId;
    }

    //分页
    function loadPageNumber(categroy) {
        $.ajax({
            type: 'GET',
            url: "/home/queryGoodsNumber/" + categroy,
            success: function (msg) {
                if (msg.success) {
                    let pages = Math.ceil(msg.data / 8);
                    $("#pagination").showPage(pages,categroy);
                } else {
                    $(".categroy.ol li:last").after('加载失败');
                }
            }

        });
    }

    function getGoods(categroy) {
        $.ajax({
            type: 'GET',
            url: "/home/queryGoods/" + categroy,
            success: function (msg) {
                if (msg.success) {
                    $(".content").empty();
                    let ele;
                    for (let i = 0, len = msg.data.length; i < len; i++) {
                        ele = msg.data[i];
                        let d = "<div class='disp'><img src='../" + ele["images"].split(",")[0] + "'><span class='description' onclick='goShopping(" + ele["id"] + ")'>" + ele["name"] + ele["description"] + "</span> <span class='price'>" + "￥" + ele["price"] + "</span><button id='btn" + ele["id"] + "' onclick='joinShoppingCart(" + ele["id"] + ")'>加入购物车</button></div>"
                        $(".content").append(d);
                    }
                }
            }

        });
    }
    function joinShoppingCart(goodsId) {
        $.ajax({
            type: 'GET',
            url: "../shopping/addGoods2ShoppingCart/" + goodsId,
            success: function (msg) {
                if (msg.success) {
                    $("#btn" + goodsId).text("已在购物车");
                    $("#btn" + goodsId).attr("disabled", "disabled");

                } else {
                    if (msg.data === "未登录") {
                        alert("请登录!!!");
                        window.location.href = "../index";
                    }
                    if (msg.data === "加入购物车失败") {
                        alert("加入购物车失败!!!");
                    }
                }
            }

        });
    }
    /**
     * 标语
     */
    function changeTitle(){
        $("#demoLi").animate({top:"-50px"}).animate({top:0},0,function(){
            let liFirst=$("#demoLi>li:first");

            $("#demoLi").append(liFirst.clone());
            liFirst.remove();
        });
    }

    /**
     * 图片轮播
     */
    function auto() {
        let broadcast = $("#broadcast"),
            img_list = $("#img_list"),
            button_list = $("#button_list li"),
            index = 0,
            timer = null;
        //初始化
        if (timer) {
            clearInterval(timer);
            timer = null;
        }
        // 自动切换
        timer = setInterval(autoPlay, 3000);
        // 调用自动播放函数
        function autoPlay() {
            index++;
            if (index >= button_list.length) {
                index = 0;
            }
            imgChange(index);
        }
        function imgChange(buttonIndex) {
            for (let i = 0; i < button_list.length; i++) {
                button_list[i].className = "";
            }
            button_list[buttonIndex].className = "first-li";//按钮样式切换
            $(img_list).css("marginLeft",-1000 * buttonIndex + "px");
            index = buttonIndex;
        }
        //鼠标接触div
        broadcast.onmouseover = function () {
            clearInterval(timer);

        }
        //鼠标离开div
        broadcast.onmouseout = function () {
            timer = setInterval(autoPlay, 2000);
        }
    }
    $.ajax({

        type: 'GET',
        url: "/home/queryName",
        success: function (msg) {
            if (msg.success) {
                $("#userName").text(msg.data);
            } else {
                $("#userName").text(msg.msg);
            }
        }

    });
    $.ajax({
        type: 'GET',
        url: "/home/queryCategroy",
        success: function (msg) {
            if (msg.success) {
                let categroies = msg.data;
                for (let i = 0,len=msg.data.length; i <len ; i++) {
                    $(".categroy ol").append("<li><div><a class='categroyLink'" +
                        " href='javascript:void(0);'>"+categroies[i]+"</a></div></li>");
                }
                for (let i = 0,len=$(".categroyLink").length; i < len; i++) {
                    $(".categroyLink:eq(" + (i) + ")").click(function () {
                        $(".categroyLink").parent("div").removeClass("active");
                        $(".categroyLink:eq(" + (i) + ")").parent("div").addClass("active");
                        if (i > 0) {
                            getGoods(this.text);
                            loadPageNumber(this.text);
                        } else {
                            getGoods("hot");
                            loadPageNumber("hot");
                        }
                    });
                }
            } else {
                $(".categroy.ol li:last").after( msg.msg);
            }
        }

    });
    window.onload = function () {
        auto();
        setInterval(changeTitle,2000);
        getGoods("hot");
        loadPageNumber("hot");
        //最后一个右边距0
        for (let i = 0; i < 8; i++) {
            if (i % 4 == 3) {
                $(".disp:eq(" + (i) + ")").addClass("last");
            }
        }
    }
</script>

</body>

</html>
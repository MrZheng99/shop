<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>表单验证</title>
    <link rel="stylesheet" href="../../css/address.css">
    <style>
        .minput{
            text-align: center;
        }
    </style>
</head>

<body>


<table class="table table-striped">
    <caption>会员信息</caption>
    <thead>
    <tr>
        <th>会员名</th>
        <th>真实姓名</th>
        <th>性别</th>
        <th>E-mail</th>
        <th>联系方式</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody class="mtbody">
    <tr>
        <td>
            <span id="aname"></span>
        </td>
        <td>
            <input type="text" name="realName" id="realName" class="minput">
            <span class="mspan" id="realNameTip"></span>
        </td>

        <td>
           <span class="mradio">
                        <label ><input type="radio"  name="sexType" value="男">男</label>
                        <label ><input type="radio" name="sexType" value="女" >女</label>
                    </span>
            <span class="mspan" id="sexTypeTip"></span>
        </td>
        <td>
            <input type="text" name="memail" id="memail" class="minput">
            <span class="mspan" id="memailTip"></span>
        </td>
        <td>
            <input type="text" name="tel" id="tel" class="minput">
            <span class="mspan" id="telTip"></span>
        </td>
        <td>
            <button class="btn btn-primary" onclick="updateInfo()">保存</button>
        </td>
    </tr>
    </tbody>
</table>

<script src="../../js/checkUtil.js"></script>
<script src="../../js/userInfo.js"></script>
<script>

    function updateInfo(){
        let realName = $.trim($("#realName").val());
        let email = $.trim($("#memail").val());
        let tel = $.trim($("#tel").val());
        let sex =  $("input[name='sexType']:checked").val();
        if(sex==null){
            fnError("sexTypeTip", "请选择");
            return;
        }else{
            fnSuccess("sexTypeTip");
        }
        if (checkTel(tel)) {
            fnSuccess("telTip");
        } else {
            fnError("telTip", "请核查");
            return;
        }
        if (checkName(realName)) {
            fnSuccess("realNameTip");
        } else {
            fnError("realNameTip", "请核查");
            return;
        }
        if (checkEmail(email)) {
            fnSuccess("memailTip");
        } else {
            fnError("memailTip", "请核查");
            return;
        }

        $.ajax({type:"post",url:"/user/updateUserInfo",
            data:{realName:realName,email:email,tel:tel,sex:sex},
            success:function(data){
                alert("修改成功");
                getUserInfoPage();
                flushUserInfo();
            },
            error:function(data){
                alert("修改失败");

            },
            dataType:"json"});

    }
    function flushUserInfo(){
        $.ajax({url:"/user/getUserInfo",success:function(data){
                $("#tel").val(data.data.tel);
                $("#memail").val(data.data.email);
                $("#realName").val(data.data.realName);
                $("#aname").text(data.data.name);
                if(data.data.sex!=null){
                    if(data.data.sex=="男"){
                        $("input[name='sexType']:first").attr('checked', 'checked');
                    }else{
                        $("input[name='sexType']:last").attr('checked', 'checked');

                    }
                }
            },
            error:function(data){

            },
            dataType:"json"});
    }
    $(function () {
      flushUserInfo();
    })
</script>
</body>

</html>
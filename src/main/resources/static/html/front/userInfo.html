<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>表单验证</title>
    <link rel="stylesheet" href="../../css/userInfo.css">
</head>

<body>
<div class="main">
    <div class="center">
        <span class="spanTop">会员信息</span>
        <form action="" class="mform" onsubmit="return false">
            <div class="form_item">
                <span class="mspan1">会员名：</span>
                <input type="text" disabled="disabled" name="aname" id="aname" class="minput">
                <span class="mspan" id="accountTip"></span>
            </div>
            <div class="form_item">
                <span class="mspan1">真实姓名：</span>
                <input type="text" name="realName" id="realName" class="minput">
                <span class="mspan" id="realNameTip"></span>
            </div>
            <div class="form_item">
                <span class="mspan1">性别：</span>
                <span class="mradio">
                        <label ><input type="radio"  name="sexType" value="男">男</label>
                        <label ><input type="radio" name="sexType" value="女" >女</label>
                    </span>
                <span class="mspan" id="sexTypeTip"></span>
            </div>
            <div class="form_item">
                <span class="mspan1">E-mail：</span>
                <input type="text" name="memail" id="memail" class="minput">
                <span class="mspan" id="memailTip"></span>
            </div>
            <div class="form_item">
                <span class="mspan1">联系方式：</span>
                <input type="text" name="tel" id="tel" class="minput">
                <span class="mspan" id="telTip"></span>
            </div>
        </form>
        <button class="button" onclick="updateInfo()">保存</button>
    </div>
</div>
<script src="../../js/checkUtil.js"></script>
<script src="../../js/userInfo.js"></script>
<script>

    function updateInfo(){
        let realName = $.trim($("#realName").val());
        let email = $.trim($("#memail").val());
        let tel = $.trim($("#tel").val());
        let sex =  $("input[name='sexType']:checked").val();
        if(sex==null){
            fnError("sexTypeTip", "请选择性别");
            return;
        }else{
            fnSuccess("sexTypeTip");
        }
        if (checkTel(tel)) {
            fnSuccess("telTip");
        } else {
            fnError("telTip", "请输入您的常用联系方式");
            return;
        }
        if (checkName(realName)) {
            fnSuccess("realNameTip");
        } else {
            fnError("realNameTip", "请输入您的真实姓名");
            return;
        }
        if (checkEmail(email)) {
            fnSuccess("memailTip");
        } else {
            fnError("memailTip", "请填写常用电子邮件");
            return;
        }

        $.ajax({type:"post",url:"/user/updateUserInfo",
            data:{realName:realName,email:email,tel:tel,sex:sex},
            success:function(data){
                alert("修改成功");
                getUserInfoPage();
                flushUserInfo();
            },
            error:function(data){

            },
            dataType:"json"});

    }
    function flushUserInfo(){
        $.ajax({url:"/user/getUserInfo",success:function(data){
                $("#tel").val(data.data.tel);
                $("#tel").val(data.data.tel);
                $("#memail").val(data.data.email);
                $("#realName").val(data.data.realName);
                $("#aname").val(data.data.name);
                if(data.data.sex!=null){
                    if(data.data.sex=="男"){
                        $("input[name='sexType']:first").attr('checked', 'checked');
                    }else{
                        $("input[name='sexType']:last").attr('checked', 'checked');

                    }
                }
            },
            error:function(data){

            },
            dataType:"json"});
    }
    $(function () {
      flushUserInfo();
    })
</script>
</body>

</html>